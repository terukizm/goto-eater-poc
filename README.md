後藤イー太(PoC)
===

# ユースケース

* GoToEat商品券が使えるお店を、Web地図から探したい
  * 現在地から
  * 指定した住所の周辺から(例: 職場の近くの店)
* お店をジャンル別に探したい
  * 「ラーメン屋だけ」探したい
* 外出先から、スマホでお店を探したい
  * モバイル端末からでもある程度、サクサク閲覧できるようにしたい
* 公式サイトの情報は定期的に更新されるので、自動的に追従されるようにしたい

以下はおまけ。

* ジオコーダの挙動がおかしくて住所からlatlngがちゃんと取れてない、そもそも公式サイトに登録されてるデータがおかしいといった問題の切り分けを行えるようにしたい
  * 「この店の場所おかしいんだけど？」みたいなこと言われたときに追いやすくしたい
* いちいち公式サイト見て利用自粛期間とかを確認するのはめんどいから、地図を見るついでに表示させたい(→未実装)

# 類似サービス

* [奈良県利用店舗マップ](https://tinyurl.com/yx8ocwwc)
  * これを各都道府県対応したものと思ってよい (欲を言えばもう少し軽いと良い)
* [GoToEatMap](https://go-to-eat-map.com/)
  * もう少し使い勝手を… (ジャンル別表示はほしい)

# 基本的な開発方針

- 死人出るもんじゃないし多少結果おかしかったり位置ずれしててもOK(1kmくらいはいいやろ)
- どうせ3月末には終わるキャンペーンだし、なにごとも適当でよい
  - 追記: なんか6月末？とかまでになりそう…
- とりあえず2末までにわしが残り40,000円分の金券を使い切れればよい
  - 追記: なんか伸びそう(栃木は1/15くらいまで自粛になった)
- 基本的にお金をかけたくないので
  - GitHub Actionsで定期実行
  - 生成したGeoJSONはpublicリポジトリに突っ込んで公開
  - WebページもGitHub Pagesで公開
  - WebMapはGeolonia様のβテスト版を使わせていただく

# 開発用サーバ起動

普通にWebサーバ上に乗っけても動くが、めんどくさければ以下で開発用サーバを起動。

* Python 3.x
  * `$ python serve3.py`
* Python 2.x
  * `$ python serve.py`

-> http://localhost:18000/
# 利用技術

- クローラ
  - Scrapy
  - pyppeteer (SPAサイト用)
- GeoJSON作成
  - PyDAMS (ジオコーダ)
- Webマップ
  - [Geolonia](https://geolonia.com/)
  - MapBox GL JS
- 自動デプロイ
  - GitHub Actions
  - GitHub Container Registry
  - GitHub Pages
## 制限事項

- pydams(ジオコーディング)で利用している住所情報の解像度の問題で、**番地以下が無視される形で**ジオコーディングが行われる
  - 隣り合うビルなどの場合は同じlatlngになり、マーカーが重なってしまう(例: イオンモール佐野新都市とかプレミアムアウトレットが地獄)
- 東京都、徳島県のGeoJSONは自動取得から公開していない
  - 徳島県は規約的なものが理由。東京都はぐ○なびだから気が引けるというのと、データ量が32k件くらいあるので。
  - どっちもクローラ自体は実装して動作確認はしてある。
- 神奈川、千葉、滋賀はlatlngを直接抜いてるのでジオコーディングを通してない。だから公式データがおかしくなければ場所ズレはないはず。
  - ただしジャンル情報そのものがないので、全部「その他」になってしまう。
